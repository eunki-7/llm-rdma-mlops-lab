global
    daemon
    maxconn 4000
    stats socket /var/run/haproxy.sock mode 660 level admin
    stats timeout 30s

defaults
    mode http
    timeout connect 2s
    timeout client  60s
    timeout server  60s
    option  http-keep-alive

frontend fe_vllm
    bind *:80
    default_backend be_vllm

backend be_vllm
    balance leastconn
    option httpchk GET /v1/models
    server node0 node0:8000 check inter 2s fall 2 rise 2
    server node1 node1:8000 check inter 2s fall 2 rise 2
    server node2 node2:8000 check inter 2s fall 2 rise 2
    server node3 node3:8000 check inter 2s fall 2 rise 2

frontend fe_metrics
    bind *:9101
    http-request use-service prometheus-exporter if { path /metrics }
